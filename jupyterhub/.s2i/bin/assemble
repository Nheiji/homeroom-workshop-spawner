#!/bin/bash

set -eo pipefail

set -x

# Ensure we are using the latest pip and wheel packages.

pip install -U pip setuptools wheel

# Install base packages needed for running JupyterHub.

pip install -r /tmp/src/requirements.txt

# Install npm packages required by JupyterHub.

echo " -----> Installing npm packages."

npm install configurable-http-proxy

# Also move into place helper scripts and the script to start JupyterHub.

mv /tmp/src/* /opt/app-root/src/

#mv /tmp/src/scripts/* /opt/app-root/bin/

#mv /tmp/src/start-jupyterhub.sh /opt/app-root/bin/

rm -rf /tmp/src

# Ensure passwd/group file intercept happens for any shell environment.

echo "source /opt/app-root/etc/generate_container_user" >> /opt/app-root/etc/scl_enable

# Create additional directories.

echo " -----> Creating additional directories."

mkdir -p /opt/app-root/data

# Fixup permissions on directories and files.

fix-permissions /opt/app-root
